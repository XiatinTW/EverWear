# EW_Member 專案結構說明

這是一個 React + Express + MySQL 的全端會員管理系統，使用分層式 MVC 架構。

## 📁 專案根目錄結構

```
EW_Member/
├── 🚀 server.js                    # 主程式入口點
├── 📦 package.json                 # 專案依賴與設定
├── 🔒 .env                         # 環境變數設定
├── 📖 README.md                    # 專案基本說明
├── 🔧 後端相關資料夾/
    - Controllers (控制器層)
    - Models (資料模型層)
    - Routes (路由層)
    - Services (服務層)
    - Middleware (中間件層)
    - Config (設定層)
    - Utils (工具函數)

├── 🎨 前端相關資料夾 src/
    - Pages (頁面組件)
    - Components (可重用組件)
    - Services (API服務)
    - Styles (樣式檔案)
    - Assets (靜態資源)
main.jsx: React 前端的入口點（類似後端的 server.js）
App.jsx: 前端路由管理（決定 URL 對應哪個頁面）
```

---

## 🔧 後端架構 (Backend)

### `/backend/` - 後端核心目錄
採用 **MVC (Model-View-Controller)** 分層架構

#### `/backend/controllers/` - 控制器層
**職責**: 處理 HTTP 請求，執行業務邏輯

```
controllers/
├── authController.js       # 會員認證邏輯 (註冊/登入/驗證)
├── userController.js       # 用戶資料管理 (個人資料CRUD)
├── contactController.js    # 聯絡訊息處理
└── orderController.js      # 訂單相關邏輯
```

**工作流程**: 接收請求 → 呼叫 Model → 處理資料 → 回傳結果

#### `/backend/models/` - 資料模型層
**職責**: 資料庫操作，SQL 查詢執行

```
models/
├── User.js                 # 用戶資料表操作 (CRUD, 密碼驗證等)
├── Contact.js              # 聯絡訊息資料操作
└── Order.js                # 訂單資料操作
```

**核心邏輯**: 
- 資料庫 CRUD 操作
- SQL 查詢封裝
- 資料驗證與處理

#### `/backend/routes/` - 路由層
**職責**: API 端點定義，請求分發

```
routes/
├── auth.js                 # 認證相關 API (/api/v2/auth/*)
├── users.js                # 用戶資料 API (/api/v2/users/*)
├── contacts.js             # 聯絡功能 API (/api/v2/contacts/*)
└── orders.js               # 訂單相關 API (/api/v2/orders/*)
```

**路由結構**: HTTP 方法 + URL 路徑 → Controller 方法

#### `/backend/services/` - 服務層
**職責**: 外部服務整合，第三方 API

```
services/
└── emailService.js         # 郵件發送服務 (Nodemailer + Gmail SMTP)
```

**功能**: 
- 驗證郵件發送
- 優惠券郵件發送
- 密碼重設郵件

#### `/backend/middleware/` - 中間件層
**職責**: 請求預處理，權限控制

```
middleware/
├── auth.js                 # JWT 權限驗證
├── validation.js           # 資料格式驗證
├── errorHandler.js         # 統一錯誤處理
└── notFound.js             # 404 處理
```

#### `/backend/config/` - 設定層
**職責**: 系統設定與連線管理

```
config/
└── database.js             # MySQL 資料庫連線設定
```

**功能**:
- 資料庫連線池管理
- 查詢執行函數
- 事務處理

#### `/backend/utils/` - 工具函數
**職責**: 共用工具與輔助函數

```
utils/
└── helpers.js              # 通用工具函數
```

**內容**: 密碼加密、JWT 生成、回應格式化等

---

## 🎨 前端架構 (Frontend)

### `/src/` - React 前端程式碼

#### `/src/pages/` - 頁面組件
**職責**: 路由對應的主要頁面

```
pages/
├── Auth.jsx                # 登入/註冊頁面
├── EmailVerification.jsx  # 郵件驗證頁面
└── account/                # 會員中心相關頁面
    ├── Profile.jsx         # 個人資料頁面
    ├── Password.jsx        # 密碼管理頁面
    └── Dashboard.jsx       # 會員儀表板
```

#### `/src/components/` - 可重用組件
**職責**: 共用 UI 組件

```
components/
└── common/                 # 通用組件
    ├── Header.jsx          # 頁面標題組件
    └── Navigation.jsx      # 導航組件
```

#### `/src/services/` - API 串接服務
**職責**: 前端與後端 API 通訊

```
services/
├── api.js                  # 主要 API 呼叫函數
└── googleAuth.js           # Google OAuth 服務
```

#### `/src/styles/` - 樣式檔案
**職責**: CSS 樣式管理

```
styles/
├── Auth.css                # 登入/註冊頁面樣式
├── EmailVerification.css  # 郵件驗證頁面樣式
└── account/                # 會員中心樣式
```

#### `/src/assets/` - 靜態資源
**職責**: 圖片、圖示等靜態檔案

---

## 📋 文件與設定

### 核心設定檔案
```
├── package.json            # 專案依賴、腳本設定
├── .env                    # 環境變數 (資料庫、API金鑰等)
├── vite.config.js          # Vite 建置設定
├── tailwind.config.js      # Tailwind CSS 設定
├── postcss.config.js       # PostCSS 處理設定
└── eslint.config.js        # ESLint 程式碼規範
```

### 文件檔案
```
├── README.md               # 專案基本介紹
├── API_DOCUMENTATION.md    # API 使用文件
├── CLAUDE.md               # Claude Code 指引
└── PROJECT_DOCUMENTATION.md # 詳細專案文件
```

---

## 🧪 測試相關

### `/test/` - 測試腳本目錄
```
test/
├── test_api.sh             # API 功能測試
├── test_email_verification.sh # 郵件驗證測試
└── test_google_register.sh # Google 登入測試
```

### 獨立測試檔案
```
├── test_verification_flow.sh    # 驗證流程測試
├── test_strict_registration.sh  # 嚴格註冊測試
└── test_birth_day_validation.js # 生日驗證測試
```

---

## 🔄 資料流向

### 典型的請求流程:
```
前端頁面 (src/pages/) 
    ↓ 呼叫 API
前端服務 (src/services/api.js)
    ↓ HTTP 請求
後端路由 (backend/routes/)
    ↓ 分發請求
後端控制器 (backend/controllers/)
    ↓ 資料操作
後端模型 (backend/models/)
    ↓ SQL 查詢
MySQL 資料庫
```

### 認證流程範例:
```
用戶填寫註冊表單 (Auth.jsx)
    ↓
API 呼叫 (api.js)
    ↓
路由接收 (routes/auth.js)
    ↓
控制器處理 (authController.js)
    ↓
郵件服務 (emailService.js) + 用戶模型 (User.js)
    ↓
發送驗證郵件 + 寫入資料庫
```

---

## 🔧 開發與部署

### 開發指令
```bash
npm start           # 同時啟動前後端
npm run dev         # 僅啟動前端 (Vite)
npm run server      # 僅啟動後端 (Express)
npm run build       # 建置前端
npm run lint        # 程式碼檢查
```

### 環境需求
- **前端**: React 18 + Vite
- **後端**: Node.js + Express
- **資料庫**: MySQL
- **郵件服務**: Gmail SMTP

---

## 📚 技術架構總結

| 層級 | 技術 | 職責 |
|------|------|------|
| **前端** | React + Vite | 用戶介面與互動 |
| **路由** | Express Router | API 端點管理 |
| **控制** | Express Controller | 業務邏輯處理 |
| **模型** | MySQL + 連線池 | 資料持久化 |
| **服務** | Nodemailer | 外部服務整合 |
| **中間件** | JWT + Validation | 安全與驗證 |

此架構採用 **關注點分離 (Separation of Concerns)** 原則，每個資料夾和檔案都有明確的職責，便於維護和擴展。